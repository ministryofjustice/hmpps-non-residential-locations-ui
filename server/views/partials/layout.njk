{% extends "govuk/template.njk" %}

{% from "../macros/breadcrumb.njk" import breadcrumb %}
{% from "govuk/components/error-summary/macro.njk" import govukErrorSummary %}
{% from "govuk/components/back-link/macro.njk" import govukBackLink %}
{% from "govuk/components/notification-banner/macro.njk" import govukNotificationBanner %}
{%- from "moj/components/alert/macro.njk" import mojAlert -%}


{% block head %}
  <link href="{{ '/assets/css/index.css' | assetMap }}" rel="stylesheet"/>

  {% if feComponents.jsIncludes %}
    {% for js in feComponents.jsIncludes %}
      <script src="{{ js }}" nonce="{{ cspNonce }}"></script>
    {% endfor %}
  {% endif %}

  {% if feComponents.cssIncludes %}
    {% for css in feComponents.cssIncludes %}
      <link href="{{ css }}" nonce="{{ cspNonce }}" rel="stylesheet" />
    {% endfor %}
  {% endif %}
{% endblock %}

{% set pageTitle = title if title === applicationName else title + ' - ' + applicationName %}
{% block pageTitle %}{{pageTitle | default(applicationName)}}{% endblock %}

{% block header %}
  {% if feComponents.header %}
    {{ feComponents.header | safe }}
  {% else %}
    {% include "./header.njk" %}
  {% endif %}
{% endblock %}

{% block bodyStart %}
{% endblock %}

{% block beforeContent %}
    <div class="govuk-width-container">
      <div class="govuk-grid-row govuk-!-margin-bottom-0">

        <div class="
          {% if minLayout %}
            govuk-grid-column-{{ minLayout }}
          {% else %}
            govuk-grid-column-two-thirds
          {% endif %}
        ">
          {% if backLink %}
            {% block backButton %}
              {{ govukBackLink({
                text: backLinkText or "Back",
                href: backLink
              }) }}
            {% endblock %}
          {% else %}
            {{ breadcrumb('', breadcrumbs, false) }}
          {% endif %}

          {% if errorlist.length %}
            {{ govukErrorSummary({
              titleText: "There is a problem",
              errorList: validationErrors,
              classes: "govuk-!-margin-top-7 govuk-!-margin-bottom-0"
            }) }}
          {% endif %}
        </div>
      </div>
    </div>

    {% if banner.success %}
      {% set html %}
        <h3 class="govuk-notification-banner__heading">
          {{ banner.success.title }}
        </h3>
        <p class="govuk-body">
          {{ banner.success.content }}
        </p>
      {% endset %}

      <div class="govuk-width-container">
        <div class="govuk-grid-row govuk-!-margin-bottom-0">
          <div class="govuk-grid-column-{{ minLayout }}">
            {{ govukNotificationBanner({
              html: html,
              type: "success",
              classes: "govuk-!-margin-top-7 govuk-!-margin-bottom-0"
            }) }}
          </div>
        </div>
      </div>
    {% endif %}

    {% if mojBanner %}
      <div class="govuk-width-container">
        <div class="govuk-grid-row govuk-!-margin-bottom-0">
          <div class="govuk-grid-column-full">
            {{ mojAlert({
              variant: mojBanner.variant,
              title: mojBanner.title,
              dismissible: mojBanner.dismissible,
              html: mojBanner.title,
              classes: "govuk-body govuk-!-margin-bottom-0"
            }) }}
          </div>
        </div>
      </div>
    {% endif %}
  {% endblock %}

{% block footer %}
  {% if feComponents.footer %}
    {{ feComponents.footer | safe }}
  {% endif %}
{% endblock %}

{% block bodyEnd %}
  <script type="module" src="{{ '/assets/js/index.js' | assetMap }}"></script>
{% endblock %}
